# Copyright (C) 2026 Eclipse Foundation and others.
#
# This program and the accompanying materials are made available under the
# terms of the Eclipse Public License v. 2.0 which is available at
# http://www.eclipse.org/legal/epl-2.0.
#
# SPDX-FileType: SOURCE
# SPDX-FileCopyrightText: 2026 Eclipse Foundation
# SPDX-License-Identifier: EPL-2.0

# .github/workflows/ci.yml
name: Continuous Integration

# runs on every branch so PRs get checked
on:
    push:
    pull_request:
    workflow_dispatch:

permissions:
    contents: read # we don't need write access in CI
    actions: read
    id-token: none
    pull-requests: write # for reporting check results if desired

jobs:
    validate-workflow:
        name: Validate workflow YAML
        runs-on: ubuntu-latest
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        steps:
            - uses: actions/checkout@v4
            - name: Lint workflow files
              uses: github/super-linter@v4
              env:
                  # FILTER_REGEX_INCLUDE: .github/workflows/*.yml
                  DEFAULT_BRANCH: main
                  YAML_CONFIG_FILE: .yamllint
                  MARKDOWN_CONFIG_FILE: .markdownlint.json
                  VALIDATE_JSON: true
                  VALIDATE_MARKDOWN: true
                  VALIDATE_YAML: true

    lint-shell:
        name: Shell Script Lint
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: Install shellcheck
              run: sudo apt-get update && sudo apt-get install -y shellcheck
            - name: Lint composite action script
              run: |
                  shellcheck action.yml
                  # if you extract scripts to .sh files, lint them here too

    exercise-action:
        name: Run tsffer action in all modes
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: Test file mode
              uses: ./
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  mode: file
                  file: README.md
            - name: Test reference mode
              uses: ./
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  mode: reference
                  reference_urls: "https://example.org"
                  asset_name: "dummy"
            - name: Test package mode
              uses: ./
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  mode: package
